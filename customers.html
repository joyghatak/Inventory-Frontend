<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customers | Inventory System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
<div class="flex h-screen">

  <aside class="w-64 bg-blue-700 text-white flex flex-col">
    <div class="p-4 text-2xl font-bold border-b border-blue-600">Inventory App</div>
    <nav class="flex-1 p-4 space-y-2 text-sm">
      <a href="dashboard.html" class="block p-2 hover:bg-blue-600 rounded">üè† Dashboard</a>
      <a href="products.html" class="block p-2 hover:bg-blue-600 rounded">üì¶ Products</a>
      <a href="suppliers.html" class="block p-2 hover:bg-blue-600 rounded">üöö Suppliers</a>
      <a href="customers.html" class="block p-2 bg-blue-600 rounded">üë§ Customers</a>
      <a href="purchases.html" class="block p-2 hover:bg-blue-600 rounded">üì• Purchases</a>
      <a href="sales.html" class="block p-2 hover:bg-blue-600 rounded">üí∞ Sales</a>
      <a href="reports.html" class="block p-2 hover:bg-blue-600 rounded">üìä Reports</a>
      <a href="settings.html" class="block p-2 hover:bg-blue-600 rounded">‚öôÔ∏è Settings</a>
      <a href="login.html" class="block p-2 text-red-300 hover:bg-red-600 rounded">üö™ Logout</a>
    </nav>
  </aside>

  <main class="flex-1 p-6 overflow-auto">
    <h1 class="text-2xl font-bold mb-6">Customers</h1>

    <div class="bg-white p-4 rounded-xl shadow mb-6">
      <h2 class="text-lg font-semibold mb-4">Add New Customer</h2>
      <form id="addCustomerForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <input type="text" id="customerName" placeholder="Customer Name" required class="border rounded-lg px-3 py-2">
        <input type="text" id="customerPhone" placeholder="Phone" class="border rounded-lg px-3 py-2">
        <input type="email" id="customerEmail" placeholder="Email" class="border rounded-lg px-3 py-2">
        <button type="submit" class="bg-blue-600 text-white rounded-lg py-2 hover:bg-blue-700">Add Customer</button>
      </form>
    </div>

    <div class="bg-white p-4 rounded-xl shadow">
      <h2 class="text-lg font-semibold mb-4">Customer List</h2>
      <table class="w-full border-collapse text-left">
        <thead>
          <tr class="bg-gray-100 text-gray-600">
            <th class="p-2">ID</th>
            <th class="p-2">Name</th>
            <th class="p-2">Phone</th>
            <th class="p-2">Email</th>
          </tr>
        </thead>
        <tbody id="customerTableBody">
          </tbody>
      </table>
      <p id="loadingStatus" class="mt-4 text-gray-500">Loading customers...</p>
    </div>
  </main>
</div>

<script>
  // ** IMPORTANT: Ensure this port matches your running backend port! **
  const API_BASE_URL = 'https://inventory-backend-5.onrender.com/api/customers';
  const tableBody = document.getElementById('customerTableBody');
  const loadingStatus = document.getElementById('loadingStatus');

  // --- 1. FETCH AND RENDER CUSTOMER DATA ---
  async function fetchCustomers() {
    try {
      const response = await fetch(API_BASE_URL);
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      const customers = await response.json();
      renderCustomers(customers);
    } catch (error) {
      console.error('Error fetching customers:', error);
      loadingStatus.textContent = `Error loading customers: ${error.message}. Is the backend running on ${API_BASE_URL}?`;
    }
  }

  function renderCustomers(customers) {
    tableBody.innerHTML = ''; // Clear previous data
    loadingStatus.style.display = 'none';

    if (customers.length === 0) {
      tableBody.innerHTML = '<tr><td colspan="4" class="p-2 text-center text-gray-500">No customers found.</td></tr>';
      return;
    }

    customers.forEach((customer, index) => {
      const row = tableBody.insertRow();
      row.className = 'border-t';
      
      // We use the last 4 characters of the MongoDB _id for simplicity
      row.insertCell().textContent = customer._id.slice(-4); 
      row.insertCell().textContent = customer.name;
      row.insertCell().textContent = customer.phone || 'N/A';
      row.insertCell().textContent = customer.email || 'N/A';
    });
  }

  // --- 2. HANDLE FORM SUBMISSION (ADD NEW CUSTOMER) ---
  document.getElementById('addCustomerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const name = document.getElementById('customerName').value;
    const phone = document.getElementById('customerPhone').value;
    const email = document.getElementById('customerEmail').value;

    const newCustomer = { name, phone, email };

    try {
      const response = await fetch(API_BASE_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(newCustomer),
      });

      if (!response.ok) {
        throw new Error('Failed to add customer. Check server console for errors.');
      }

      // Clear the form and reload the customer list
      document.getElementById('addCustomerForm').reset();
      fetchCustomers(); 
      alert('Customer added successfully!');

    } catch (error) {
      console.error('Error adding customer:', error);
      alert(error.message);
    }
  });

  // Load data when the page opens
  fetchCustomers();

</script>
</body>
</html>
